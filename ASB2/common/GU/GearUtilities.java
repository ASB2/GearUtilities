package GU;

import java.util.Arrays;
import java.util.Random;
import java.util.logging.Level;
import java.util.logging.Logger;

import javax.security.auth.login.Configuration;

import net.minecraft.creativetab.CreativeTabs;
import net.minecraft.init.Blocks;
import net.minecraft.world.World;
import net.minecraft.world.chunk.IChunkProvider;
import net.minecraft.world.gen.feature.WorldGenMinable;
import net.minecraftforge.common.ForgeChunkManager;
import net.minecraftforge.common.MinecraftForge;
import net.minecraftforge.fml.common.FMLCommonHandler;
import net.minecraftforge.fml.common.Mod;
import net.minecraftforge.fml.common.Mod.EventHandler;
import net.minecraftforge.fml.common.Mod.Instance;
import net.minecraftforge.fml.common.ModMetadata;
import net.minecraftforge.fml.common.SidedProxy;
import net.minecraftforge.fml.common.event.FMLInitializationEvent;
import net.minecraftforge.fml.common.event.FMLInterModComms;
import net.minecraftforge.fml.common.event.FMLPostInitializationEvent;
import net.minecraftforge.fml.common.event.FMLPreInitializationEvent;
import net.minecraftforge.fml.common.event.FMLServerStartedEvent;
import net.minecraftforge.fml.common.event.FMLServerStartingEvent;
import net.minecraftforge.fml.common.event.FMLServerStoppedEvent;
import net.minecraftforge.fml.common.event.FMLServerStoppingEvent;
import net.minecraftforge.fml.common.network.NetworkRegistry;
import net.minecraftforge.fml.common.network.simpleimpl.SimpleNetworkWrapper;
import net.minecraftforge.fml.common.registry.GameRegistry;
import GU.commands.BreakBlockCommand;
import GU.info.Reference;
import GU.info.Variables;
import GU.proxy.CommonProxy;
import GU.worldGen.WorldGenBase;

@Mod(modid = Reference.MOD_ID, version = Reference.VERSION)
public final class GearUtilities {
    
    @Instance(Reference.MOD_ID)
    public static GearUtilities instance;
    
    @SidedProxy(clientSide = Reference.CLIENT_PROXY, serverSide = Reference.COMMON_PROXY)
    public static CommonProxy proxy;
    
    private static Logger GU_LOGGER = Logger.getLogger(Reference.NAME);
    private static final SimpleNetworkWrapper packetPipeline = new SimpleNetworkWrapper(Reference.MOD_CHANNEL);
    
    public static CreativeTabs tabGUBlocks = new GUCreativeTab(Reference.NAME.concat(": Blocks"));
    public static CreativeTabs tabGUItems = new GUCreativeTab(Reference.NAME.concat(": Items"));
    public static CreativeTabs tabGUFluids = new GUCreativeTab(Reference.NAME.concat(": Fluids"));
    public static CreativeTabs tabGUStructureCubes = new GUCreativeTab(Reference.NAME.concat(": Structure Cubes"));
    
    public GearUtilities() {
        // TODO Auto-generated constructor stub
    }
    
    @EventHandler
    public void preInit(FMLPreInitializationEvent event) {
        
        instance = this;
        
        Configuration config = new Configuration(event.getSuggestedConfigurationFile());
        config.load();
        
        Variables.updateVariables(config);
        
        proxy.register();
        
        ItemRegistry.init(config);
        BlockRegistry.init(config);
        FluidRegistry.initFluids();
        RetroGenManager.init();
        EntityRegistry.init();
        MultiRegistry.init();
        PlayerRegistry.init();
        
        proxy.registerRendereres();
        
        MinecraftForge.EVENT_BUS.register(EventListener.instance);
        FMLCommonHandler.instance().bus().register(EventListener.instance);
        NetworkRegistry.INSTANCE.registerGuiHandler(this, new GUGuiHandler());
        ForgeChunkManager.setForcedChunkLoadingCallback(this, new GUChunkLoadingCallback());
        // GameRegistry.registerFuelHandler(new IFuelHandler() {
        //
        // @Override
        // public int getBurnTime(ItemStack fuel) {
        //
        // return fuel ==
        // net.minecraftforge.fluids.FluidContainerRegistry.fillFluidContainer(new
        // FluidStack(net.minecraftforge.fluids.FluidRegistry.LAVA, 1000), new
        // ItemStack(ItemRegistry.ITEM_FLUID)) ? 10000000 : 0;
        // }
        // });
        
        ModMetadata metadata = event.getModMetadata();
        metadata.autogenerated = false;
        metadata.authorList = Arrays.asList("ASB2");
        metadata.description = "A mod from ASB2 to ASB2";
        metadata.logoFile = Reference.MOD_ID + ":assets/" + Reference.MOD_ID + "/banner.png";
        
        config.save();
    }
    
    @EventHandler
    public void mainInit(FMLInitializationEvent event) {
        
        GameRegistry.registerWorldGenerator(new WorldGenBase() {
            
            @Override
            public void generate(World world, Random random, int x, int y, int z) {
                
                new WorldGenMinable(BlockRegistry.METADATA_ORE, 0, 30, Blocks.stone).generate(world, random, x, y, z);
            }
            
            @Override
            public int generationsPerChunk(Random random, int chunkX, int chunkZ, World world, IChunkProvider chunkGenerator, IChunkProvider chunkProvider) {
                
                return 5;
            }
        }, 0);
        
        GameRegistry.registerWorldGenerator(new WorldGenBase() {
            
            @Override
            public void generate(World world, Random random, int x, int y, int z) {
                
                new WorldGenMinable(BlockRegistry.METADATA_ORE, 1, 20, BlockRegistry.METADATA_ORE).generate(world, random, x, y, z);
            }
            
            @Override
            public int generationsPerChunk(Random random, int chunkX, int chunkZ, World world, IChunkProvider chunkGenerator, IChunkProvider chunkProvider) {
                
                return 1;
            }
        }, 1);
        
        GameRegistry.registerWorldGenerator(new WorldGenBase() {
            
            @Override
            public void generate(World world, Random random, int x, int y, int z) {
                
                new WorldGenMinable(BlockRegistry.METADATA_ORE, 2, 15, BlockRegistry.METADATA_ORE).generate(world, random, x, y, z);
            }
            
            @Override
            public int generationsPerChunk(Random random, int chunkX, int chunkZ, World world, IChunkProvider chunkGenerator, IChunkProvider chunkProvider) {
                
                return 1;
            }
        }, 1);
        
        // DimensionManager.registerProviderType(373,
        // ElectisVoidWorldProvider.class, true);
    }
    
    @EventHandler
    public void postInit(FMLPostInitializationEvent event) {
        
        FluidRegistry.registerFluidContainers();
        CraftRegistry.init();
        PacketRegistry.init();
        
        // WhiteLists.getInstance().addWrench(new
        // ItemStack(ItemRegistry.ItemAdvancedStick));
    }
    
    @EventHandler
    public void serverStarting(FMLServerStartingEvent event) {
        
        event.registerServerCommand(new BreakBlockCommand());
    }
    
    @EventHandler
    public void serverStarted(FMLServerStartedEvent event) {
        
        // DimensionManager.initDimension(Reference.GHOST_DIMENSION_ID);
    }
    
    @EventHandler
    public void serverStopping(FMLServerStoppingEvent event) {
    }
    
    @EventHandler
    public void serverStopped(FMLServerStoppedEvent event) {
    }
    
    @EventHandler
    public void processIMCRequests(FMLInterModComms.IMCEvent event) {
        
    }
    
    public static SimpleNetworkWrapper getPipeline() {
        
        return packetPipeline;
    }
    
    public static void log(Object message) {
        
        GU_LOGGER.log(Level.INFO, message != null ? message.toString() : "null");
    }
}
